<!DOCTYPE html>
<html lang="en">
<head>

<link rel="icon" type="image/png" href="../favicon.png">
<link rel="icon" type="image/x-icon" href="../favicon.ico">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Market Stats | 615 Realty Guy</title>

<style>

/* ============================= */
/* GLOBAL SITE STYLES */
/* ============================= */

body {
    font-family: 'Futura', sans-serif;
    background-color: #000000;
    color: #d2b56c;
    margin: 0;
    padding: 0;
    text-align: center;
}

/* Gold Gradient Headings */
h1, h2 {
    background: linear-gradient(to right, #feee9f, #b18841);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* Header */
header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 40px;
    background: black;
}

.logo img {
    max-width: 100px;
}

nav {
    display: flex;
    gap: 20px;
}

nav a {
    color: #d2b56c;
    text-decoration: none;
    font-weight: bold;
    transition: 0.3s;
}

nav a:hover {
    color: #feee9f;
}

/* ============================= */
/* RATE CARD */
/* ============================= */

.rate-card {
    max-width: 700px;
    margin: 60px auto 30px auto;
    padding: 30px;
    background: linear-gradient(145deg, #0f0f12, #1a1a1f);
    border: 1px solid rgba(210,181,108,0.25);
    border-radius: 16px;
    box-shadow: 0 25px 50px rgba(0,0,0,0.6);
}

.rate-title {
    font-size: 18px;
    letter-spacing: 1px;
    margin-bottom: 10px;
}

.rate-value {
    font-size: 56px;
    font-weight: bold;
    background: linear-gradient(to right, #feee9f, #b18841);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.rate-date {
    font-size: 13px;
    color: #999;
    margin-top: 10px;
}

/* ============================= */
/* MARKET WIDGET */
/* ============================= */

.market-widget{
    width: 800px;
    margin: 0 auto 80px auto;
    background: linear-gradient(145deg, #0f0f12, #1a1a1f);
    border-radius:16px;
    box-shadow:0 25px 60px rgba(0,0,0,0.6);
    overflow:hidden;
}

.widget-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 20px;
    background: rgba(0,0,0,0.3);
}

#marketSelect{
    background:#1e1e22;
    color:#fff;
    border:1px solid rgba(255,255,255,0.1);
    border-radius:8px;
    padding:8px 12px;
}

.widget-indicator{
    font-size:14px;
    color:#b18841;
}

.widget-frame{
    position:relative;
    width:100%;
    height:500px;
    background:#000;
}

.widget-frame iframe{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    border:0;
    opacity:0;
    transition: opacity .5s ease;
}

.widget-frame iframe.active{
    opacity:1;
}

.nav{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    width:36px;
    height:36px;
    border-radius:50%;
    background: rgba(0,0,0,0.6);
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    font-size:20px;
    border:1px solid rgba(255,255,255,0.2);
}

.nav.left{ left:15px; }
.nav.right{ right:15px; }

@media(max-width:900px){
    .market-widget{
        width:95%;
    }
}

</style>
</head>

<body>

<header>
  <div class="logo">
    <a href="../index.html">
      <img src="https://i.imgur.com/Mue4Nnr.png" alt="615 Logo">
    </a>
  </div>
  <nav>
    <a href="../index.html">Home</a>
    <a href="../about.html">About</a>
    <a href="https://substack.com/@615realtyguy" target="_blank">Blog</a>
  </nav>
</header>

<!-- Mortgage Rate Card -->
<div class="rate-card">
  <div class="rate-title">30-Year Fixed Mortgage Rate</div>
  <div class="rate-value" id="mortgageRate">Loading...</div>
  <div class="rate-date" id="rateDate"></div>
</div>

<!-- Market Widget -->
<div class="market-widget">
  <div class="widget-header">
      <select id="marketSelect"></select>
      <div class="widget-indicator" id="indicator">—</div>
  </div>

  <div class="widget-frame" id="frameHost">
      <div class="nav left" id="btnPrev">‹</div>
      <div class="nav right" id="btnNext">›</div>
  </div>
</div>

<script>

/* ============================= */
/* FRED API RATE */
/* ============================= */

async function fetchMortgageRate() {
    const apiKey = "34684a23adfe87cc951f21b8364a46a8";
    const url = `https://api.stlouisfed.org/fred/series/observations?series_id=MORTGAGE30US&api_key=${apiKey}&file_type=json&sort_order=desc&limit=1`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        const latest = data.observations[0];
        document.getElementById("mortgageRate").innerText = latest.value + "%";
        document.getElementById("rateDate").innerText = "As of " + latest.date;
    } catch (error) {
        document.getElementById("mortgageRate").innerText = "Unavailable";
    }
}
fetchMortgageRate();

/* ============================= */
/* MARKET ROTATOR */
/* ============================= */

const markets = {
  "White House (37188)": [
    { label:"Pricing Trends", url:"https://go.realtracs.com/1evji2y"},
    { label:"Price per Sqft", url:"https://go.realtracs.com/1evjUG3"},
    { label:"DOM", url:"https://go.realtracs.com/1evjb2g"},
    { label:"Showings", url:"https://go.realtracs.com/1evjhE7"},
    { label:"Months Supply", url:"https://go.realtracs.com/1evjm6O"},
    { label:"Market Inventory", url:"https://go.realtracs.com/1evjo1D"},
  ],
  "Robertson County": [
    { label:"Pricing Trends", url:"https://go.realtracs.com/1evlNAJ"},
    { label:"Price per Sqft", url:"https://go.realtracs.com/1evlX6f"},
    { label:"DOM", url:"https://go.realtracs.com/1evlTFp"},
    { label:"Showings", url:"https://go.realtracs.com/1evlcFx"},
  ],
  "Sumner County": [
    { label:"Pricing Trends", url:"https://go.realtracs.com/1evlq6b"},
    { label:"Price per Sqft", url:"https://go.realtracs.com/1evlu8q"},
    { label:"DOM", url:"https://go.realtracs.com/1evlhDS"},
    { label:"Showings", url:"https://go.realtracs.com/1evle3V"},
  ]
};

const select = document.getElementById("marketSelect");
const frameHost = document.getElementById("frameHost");
const indicator = document.getElementById("indicator");
const btnPrev = document.getElementById("btnPrev");
const btnNext = document.getElementById("btnNext");

let frames = [];
let currentIndex = 0;
let currentMarket = null;

function populateDropdown(){
    Object.keys(markets).forEach(name=>{
        const opt=document.createElement("option");
        opt.value=name;
        opt.textContent=name;
        select.appendChild(opt);
    });
}

function buildIframes(market){
    frames.forEach(f=>f.remove());
    frames=[];
    currentMarket=market;
    markets[market].forEach(chart=>{
        const iframe=document.createElement("iframe");
        iframe.src=chart.url;
        frameHost.insertBefore(iframe, btnPrev);
        frames.push(iframe);
    });
    currentIndex=0;
    showFrame(0);
}

function showFrame(idx){
    frames.forEach((f,i)=>f.classList.toggle("active",i===idx));
    indicator.textContent = markets[currentMarket][idx].label;
}

btnNext.onclick=()=>{
    currentIndex=(currentIndex+1)%frames.length;
    showFrame(currentIndex);
};

btnPrev.onclick=()=>{
    currentIndex=(currentIndex-1+frames.length)%frames.length;
    showFrame(currentIndex);
};

select.addEventListener("change",()=>buildIframes(select.value));

populateDropdown();
select.value="White House (37188)";
buildIframes(select.value);

</script>

</body>
</html>
